---
title: 'Force-based regulation of splicing during myoblast differentiation'
subtitle: "Stage 1: Bioinformatical Analysis of Myogenic Transcripts"
author: "Andrés Gordo Ortiz @Al Jord Lab CRG"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_document:
    code_folding: show
    code_download: false  
    df_print: paged
    theme: flatly
    highlight: tango
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    number_sections: true

editor_options: 
  markdown: 
    wrap: 72
    
# NOTE: To run this R Markdown file correctly, set the Knit Directory to the Project Directory.
# You can do this by navigating to the gear icon next to the Knit button in RStudio,
# and selecting "Project Directory" as the option. This ensures paths resolve correctly.
---

```{css, echo=FALSE}
/* Custom CSS to enhance styling */
body {
  font-family: 'Gill Sans', sans-serif;
}

h1 {
  color: #2c3e50;
  font-family: 'Ubuntu', sans-serif; /* Set header font to Ubuntu */
}

h2 {
  color: #3498db;
  font-family: 'Ubuntu', sans-serif; /* Set header font to Ubuntu */
}

h3 {
  color: #7DE2D1;
  font-family: 'Ubuntu', sans-serif; /* Set header font to Ubuntu */
}
p {
  text-align: justify;
}
```

```{r setup, include=FALSE}
# Ensure a clean environment and load required libraries.
knitr::opts_chunk$set(
  echo = TRUE, 
  warning = FALSE, 
  message = FALSE
)

# Function to install and load packages dynamically.
install_load <- function(pkg) {
  if (!require(pkg, character.only = TRUE)) {
    install.packages(pkg, dependencies = TRUE)
    library(pkg, character.only = TRUE)
  }
}

# Load required libraries
install_load("betAS")
install_load("ggplot2")
install_load("plotly")
install_load("dplyr")
install_load("cowplot")
install_load("DT")
library("org.Mm.eg.db")
library("enrichplot")
library("DOSE")
library("clusterProfiler")
library("ReactomePA")
```

# Introduction to this Analysis

## Objective

The primary aim is to identify a list of splicing events that meet the following criteria:
1. **Differential Splicing**: Events are differentially spliced during myoblast differentiation.
2. **Spatial Relevance**: Events occur near or around nuclear speckles.

This analysis is structured into four distinct parts, each focusing on a critical step towards achieving the final goal.

---

## **Part 1: Upstream Analysis**

The upstream analysis is performed on the CRG cluster using the Bash command line. This phase involves:

1. **Data Acquisition**: 
   - Downloading `*.fastq.gz` files from five different databases.

2. **Alignment**: 
   - Aligning the sequences to the latest mouse genome release (mm10) using **Bowtie2** through the [Vast-Tools align function](https://link.springer.com/protocol/10.1007/978-1-0716-2521-7_7).

3. **Event Detection**:
   - Importing inclusion tables generated by Vast-Tools into RStudio. The tables cover the following splicing events:
     - **Exons (EX)**
     - **Introns (IN)**
     - **Alternative 5' Splice Sites (Alt5)**
     - **Alternative 3' Splice Sites (Alt3)**
     - **Microexons (MIC)**

---

## **Part 2: Statistical Analysis**

### Objective
To identify splicing events that are differentially spliced during myoblast differentiation.

### Steps

1. **Statistical Testing**: 
   - Use the [betAS package](https://rnajournal.cshlp.org/content/30/4/337) in R to perform:
     - **False Discovery Rate (FDR)**
     - **F-statistic**
     - **Probability of Differential Splicing (Pdiff)**

2. **Filtering Criteria**:
   - Retain events with:
     - **FDR ≤ 0.05**
     - **Pdiff ≥ 0.95**

3. **Batch Effect Mitigation**:
   - Each database is analyzed independently to control for batch effects and confounders.
   - A final list is generated by intersecting the splicing events identified in all five databases. This ensures the events are associated exclusively with differentiation.

4. **Integration of Results**:
   - Fourteen lists (7 for exons and 7 for introns) are generated:
     - Two databases contain multiple differentiation conditions, requiring additional ANOVA tables for more stringent filtering.
   - Shared events across lists are conserved and ranked by:
     - **F-statistic**
     - **ΔPSI (Differential Percentage Spliced In)**

5. **Candidate Selection**:
   - The top 100 ranked events are selected for downstream analysis.

---

## **Part 3: Sequence Feature Analysis**

### Objective
To characterize the sequence features of candidate events using computational tools.

### Steps

1. **Feature Extraction**:
   - Run analysis on the CRG cluster using [Matt](https://academic.oup.com/bioinformatics/article/35/1/130/5053311) to extract:
     - **CG content**
     - **Sequence length**
     - **5'/3' splice site scores**

2. **Data Integration**:
   - Return the processed dataset to R for subsequent analysis.

---

## **Part 4: Functional Annotation and Scoring**

### Objective
To determine the functional relevance of candidate splicing events in myoblast differentiation and their spatial association with nuclear speckles.

### Steps

1. **Gene Ontology and Literature Mining**:
   - Use gene ontology tools and literature review to:
     - Assess the functional role of genes.
     - Identify associations with myoblast differentiation and nuclear speckles.

2. **Scoring System**:
   - Develop a scoring framework to rank transcripts based on:
     - Functional relevance
     - Sequence features
     - Spatial proximity to nuclear speckles

---

## Data Availability

| Name              | Publisher                             | ENA Link  | Year | Study Specs                                                                                                                                                                                           | Details                                                 |
|-------------------|---------------------------------------|-----------|------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
| Kuo Zhang         | Nature Communications                 | [SRP160431](https://www.ebi.ac.uk/ena/browser/view/SRP160431) | 2018 | Reads from knock-down and shControl cells in myoblast and myotube stages. Controls include 3 paired-end biological replicates each for myoblast and myotubes, totaling 12 fastq files.                | ~30M per biosample                                      |
| Lingjian Tao      | Molecular Biotechnology               | [SRP496253](https://www.ebi.ac.uk/ena/browser/view/SRP496253) | 2024 | Myotube formation observed after 4 days, full maturation at 7 days. 3 paired-end biological replicates per condition across 4 timepoints (0, 2, 4, 7 days), totaling 24 fastq files.                  | ~44M per biosample                                      |
| Pengcheng Lyu     | MDPI Cells (data quality verified)    | [SRP335878](https://www.ebi.ac.uk/ena/browser/view/SRP335878) | 2022 | C2C12 cells differentiated in media, with autophagy inhibition using chloroquine (10 µM or 20 µM). 2 paired-end biological replicates per condition for myoblast and myotube stages, 8 fastq files.   | ~45M per biosample                                      |
| Dominic W. Kolonay | Frontiers in Cell and Developmental Biology | [SRP471123](https://www.ebi.ac.uk/ena/browser/view/SRP471123) | 2024 | Myoblasts differentiated to myotubes in DMEM with horse serum and antibiotics over 5 days. 3 paired-end biological replicates per condition (0 days myoblast, 5 days myotube), totaling 12 fastq files. | ~90M per biosample in myotubes, ~140M per biosample in myoblasts |
| Christopher Azar  | Physiological Reports                 | [SRP198848](https://www.ebi.ac.uk/ena/browser/view/SRP198848) | 2021 | Cells differentiated for 6 days with daily media changes. 3 single-end biological replicates per condition (0 days myoblast, 6 days myotube), totaling 6 fastq files.                                 | ~30M per biosample

---


